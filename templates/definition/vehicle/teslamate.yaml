template: teslamate
products:
  - description:
      generic: TeslaMate
group: generic
requirements:
  description:
    en: Open source Tesla data logger https://github.com/adriankumpf/teslamate. MQTT broker required.
    de: Open Source Tesla Datenlogger https://github.com/adriankumpf/teslamate. Voraussetzung ist konfigurierter MQTT Broker.
params:
  - preset: vehicle-common
  - name: id
    description:
      de: Fahrzeug-ID
      en: Vehicle ID
    default: 1
  - name: timeout
    default: 1h
render: |
  type: custom
  {{- include "vehicle-common" . }}
  soc:
    source: mqtt
    topic: teslamate/cars/{{ .id }}/battery_level
    timeout: {{ .timeout }}
  status:
    source: combined
    plugged:
      source: mqtt
      topic: teslamate/cars/{{ .id }}/plugged_in
      timeout: {{ .timeout }}
    charging:
      source: go
      script: |
        charging_state == "Charging"
      in:
        - name: charging_state
          type: string
          config:
            source: mqtt
            topic: teslamate/cars/{{ .id }}/charging_state
            timeout: {{ .timeout }}
  range:
    source: mqtt
    topic: teslamate/cars/{{ .id }}/rated_battery_range_km
    timeout: {{ .timeout }}
  odometer:
    source: mqtt
    topic: teslamate/cars/{{ .id }}/odometer
    timeout: {{ .timeout }}
  limitsoc:
    source: mqtt
    topic: teslamate/cars/{{ .id }}/charge_limit_soc
    timeout: {{ .timeout }}
  features: ["coarsecurrent"]